<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokePlush Paradise</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css') }}">
    <script src='main.js'></script>
</head>
<body>
    <h1>PokePlush Paradise</h1>
    
    <nav>
        <ul>
            <li><a href="{{ url_for('index') }}">Home</a></li>
            <li><a href="{{ url_for('customers') }}">Customers</a></li>
            <li><a href="{{ url_for('pokemon') }}">Pokemon</a></li>
            <li><a href="{{ url_for('sales') }}">Sales</a></li>
            <li><a href="{{ url_for('sale_items') }}">SaleItems</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <h2>Pokemon</h2>
        <button onclick="openModal('addModal')">Add New</button>
        <table id="pokemonTable">
            <tr>
                <th>Edit</th>
                <th>Delete</th>
                <th>Plushie ID</th>
                <th>Plushie Name</th>
                <th>Plushie Type</th>
                <th>Price</th>
                <th>Stock Quantity</th>
            </tr>
        </table>
    </main>
        
 <!-- Add Modal -->
 <div id="addModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addModal')">&times;</span>
        <h2>Add New Plushie</h2>
        <form id="addPlushieForm">
            <label>Name: *</label> <input type="text" id="addName" required>
            <label>Type: *</label> <input type="text" id="addType" required>
            <label>Price: *</label> <input type="number" id="addPrice" step="0.01" required>
            <label>Stock Quantity: *</label> <input type="number" id="addStock" required>
            <button class="btn btn-add" type="button" onclick="addPlushie()">Add</button>
            <button class="btn" type="button" onclick="closeModal('addModal')">Cancel</button>
        </form>
    </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('editModal')">&times;</span>
        <h2>Edit Plushie</h2>
        <form id="editPlushieForm">
            <input type="hidden" id="editPlushieID">
            <label>Name: *</label> <input type="text" id="editName" required>
            <label>Type: *</label> <input type="text" id="editType" required>
            <label>Price: *</label> <input type="number" id="editPrice" step="0.01" required>
            <label>Stock Quantity: *</label> <input type="number" id="editStock" required>
            <button class="btn btn-edit" type="button" onclick="updatePlushie()">Save</button>
            <button class="btn" type="button" onclick="closeModal('editModal')">Cancel</button>
        </form>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('deleteModal')">&times;</span>
        <h2>Confirm Deletion</h2>
        <p>Are you sure you want to delete <strong><span id="deleteName"></span></strong>?</p>
        <button class="btn btn-delete" id="confirmDelete" onclick="deletePlushie()">Delete</button>
        <button class="btn" type="button" onclick="closeModal('deleteModal')">Cancel</button>
    </div>
</div>

<script>
    function populateTable() {
        fetch('/api/pokemon')
            .then(response => response.json())
            .then(plushies => {
                const table = document.getElementById("pokemonTable");
                table.innerHTML = `
                    <tr>
                        <th>Edit</th>
                        <th>Delete</th>
                        <th>Plushie ID</th>
                        <th>Plushie Name</th>
                        <th>Plushie Type</th>
                        <th>Price</th>
                        <th>Stock Quantity</th>
                    </tr>`;
                plushies.forEach(plush => {
                    let row = `<tr>
                        <td><button onclick="openEditModal(${plush.plushieID}, '${plush.plushieName}', '${plush.plushieType}', ${plush.price}, ${plush.stockQty})">Edit</button></td>
                        <td><button onclick="openDeleteModal(${plush.plushieID}, '${plush.plushieName}')">Delete</button></td>
                        <td>${plush.plushieID}</td>
                        <td>${plush.plushieName}</td>
                        <td>${plush.plushieType}</td>
                        <td>$${plush.price.toFixed(2)}</td>
                        <td>${plush.stockQty}</td>
                    </tr>`;
                    table.innerHTML += row;
                });
            })
            .catch(error => console.error('Error loading plushies:', error));
    }

    function addPlushie() {
        const data = {
            plushieName: document.getElementById("addName").value,
            type: document.getElementById("addType").value,
            price: parseFloat(document.getElementById("addPrice").value),
            stockQty: parseInt(document.getElementById("addStock").value)
        };

        fetch('/api/pokemon', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(() => { closeModal('addModal'); populateTable(); })
        .catch(error => console.error('Error adding plushie:', error));
    }

    function openEditModal(id, name, type, price, stock) {
        document.getElementById("editPlushieID").value = id;
        document.getElementById("editName").value = name;
        document.getElementById("editType").value = type;
        document.getElementById("editPrice").value = price;
        document.getElementById("editStock").value = stock;
        openModal('editModal');
    }

    function updatePlushie() {
        const id = document.getElementById("editPlushieID").value;
        const data = {
            plushieName: document.getElementById("editName").value,
            type: document.getElementById("editType").value,
            price: parseFloat(document.getElementById("editPrice").value),
            stockQty: parseInt(document.getElementById("editStock").value)
        };

        fetch(`/api/pokemon/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(() => { closeModal('editModal'); populateTable(); })
        .catch(error => console.error('Error updating plushie:', error));
    }

    function openDeleteModal(id, name) {
        document.getElementById("deleteName").textContent = name;
        document.getElementById("confirmDelete").setAttribute("onclick", `deletePlushie(${id})`);
        openModal('deleteModal');
    }

    function deletePlushie(id) {
        fetch(`/api/pokemon/${id}`, { method: 'DELETE' })
        .then(() => { closeModal('deleteModal'); populateTable(); })
        .catch(error => console.error('Error deleting plushie:', error));
    }

    function openModal(modalID) { document.getElementById(modalID).style.display = "block"; }
    function closeModal(modalID) { document.getElementById(modalID).style.display = "none"; }

    document.addEventListener("DOMContentLoaded", populateTable);
</script>
</body>
</html>